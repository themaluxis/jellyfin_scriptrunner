<!DOCTYPE html>
<html lang="en">
<head>
    <title>Shell Executor</title>
</head>
<body>
    <div id="shellExecutorConfigPage" data-role="page" class="page type-interior pluginConfigurationPage" data-require="emby-input,emby-button,emby-checkbox">
        <div data-role="content">
            <div class="content-primary">
                <form id="shellExecutorConfigForm">
                    <div class="sectionTitleContainer">
                        <h2 class="sectionTitle">Shell Executor Configuration</h2>
                    </div>
                    <div class="verticalSection">
                        <div class="inputContainer">
                            <label class="inputLabel" for="scriptContent">Script Content</label>
                            <textarea id="scriptContent" class="emby-textarea" rows="20" style="font-family: monospace; width: 100%;"></textarea>
                            <div class="fieldDescription">Edit the shell script that will be executed when the plugin initializes.</div>
                        </div>
                    </div>
                    <div>
                        <button is="emby-button" type="submit" class="raised button-submit block emby-button">
                            <span>Save</span>
                        </button>
                        <button is="emby-button" type="button" class="raised button-cancel block emby-button" id="executeNow">
                            <span>Execute Now</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
        <script type="text/javascript">
            var ShellExecutorConfig = {
                pluginUniqueId: 'eb5d7894-8eef-4b36-aa7f-5d124e828ce1'
            };

            document.getElementById('shellExecutorConfigPage').addEventListener('pageshow', function() {
                Dashboard.showLoadingMsg();
                ApiClient.getPluginConfiguration(ShellExecutorConfig.pluginUniqueId).then(function(config) {
                    document.getElementById('scriptContent').value = config.ScriptContent || '';
                    Dashboard.hideLoadingMsg();
                });
            });

            document.getElementById('shellExecutorConfigForm').addEventListener('submit', function(e) {
                e.preventDefault();
                Dashboard.showLoadingMsg();
                ApiClient.getPluginConfiguration(ShellExecutorConfig.pluginUniqueId).then(function(config) {
                    config.ScriptContent = document.getElementById('scriptContent').value;
                    ApiClient.updatePluginConfiguration(ShellExecutorConfig.pluginUniqueId, config).then(function() {
                        Dashboard.processPluginConfigurationUpdateResult();
                    });
                });
                return false;
            });

            document.getElementById('executeNow').addEventListener('click', function() {
                Dashboard.showLoadingMsg();
                
                // First save the current script content
                ApiClient.getPluginConfiguration(ShellExecutorConfig.pluginUniqueId).then(function(config) {
                    config.ScriptContent = document.getElementById('scriptContent').value;
                    ApiClient.updatePluginConfiguration(ShellExecutorConfig.pluginUniqueId, config).then(function() {
                        // Then execute the script
                        var url = ApiClient.getUrl('plugins/shellexecutor/Execute');
                        ApiClient.ajax({
                            type: 'POST',
                            url: url
                        }).then(function(result) {
                            Dashboard.hideLoadingMsg();
                            if (result.Success) {
                                Dashboard.alert('Script executed successfully. Check the logs for output.');
                            } else {
                                Dashboard.alert('Script execution failed: ' + result.Message);
                            }
                        }).catch(function(error) {
                            Dashboard.hideLoadingMsg();